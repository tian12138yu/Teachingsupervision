<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tjy.dao.AdminDao">
    <select id="getAllWork" resultType="com.tjy.domian.Work">
       	SELECT * FROM works
        <if test="wname !=null ">
            WHERE wname like #{wname}
        </if>

        LIMIT #{pageStart},#{pageSize}
    </select>

    <select id="getNoWorks" resultType="com.tjy.domian.Work">
        SELECT * FROM works
        <if test="wname !=null ">
            WHERE wname like #{wname}
        </if>
        and isfinished = 2
        LIMIT #{pageStart},#{pageSize}
    </select>

    <select id="getMyWork" resultType="com.tjy.domian.Work">
        SELECT * FROM works
        <if test="wname !=null ">
            WHERE wname like #{wname}
        </if>
        and tid = #{id}
        LIMIT #{pageStart},#{pageSize}
    </select>

    <select id="getCourseList" resultType="com.tjy.domian.Course">
        SELECT * FROM course where 1=1
        <if test="cname !=null and cname != ''">
             and cname like CONCAT('%',#{cname},'%')
        </if>
        <if test="cid !=null and cid != ''">
            and cid = #{cid}
        </if>
        <if test="tid !=null and tid != ''">
            and tid like CONCAT('%',#{tid},'%')
        </if>
        <if test="departmentname !=null and departmentname != ''">
            and departmentname  like CONCAT('%',#{departmentname},'%')
        </if>
        <if test="majorname !=null and majorname != ''">
            and majorname like CONCAT('%',#{majorname},'%')
        </if>
        LIMIT #{pageStart},#{pageSize}
    </select>

    <select id="getAllWorkCounts" resultType="java.lang.Integer">
       	SELECT count(*) FROM `works`
        <if test="wname !=null ">
            WHERE wname like #{wname}
        </if>
    </select>

    <select id="getNoWorksCounts" resultType="java.lang.Integer">
        SELECT count(*) FROM `works`
        <if test="wname !=null ">
            WHERE wname like #{wname}
        </if>
        and isfinished = 2
    </select>

    <select id="getCourseMap"  resultType="com.tjy.domian.CourseParam" >
        SELECT cid,cname FROM course
    </select>


    <select id="getTeacherList"  resultType="java.lang.String" >
        SELECT name FROM easyUser where state = 1 and role = '0' order by name;
    </select>


    <select id="getCidByName"  resultType="com.tjy.domian.Course" >
        SELECT * FROM course where cname = #{val}
    </select>

    <select id="getidByName"  resultType="java.lang.Integer" >
        SELECT id FROM easyUser where name = #{val}
    </select>


    <select id="getMyWorkCounts" resultType="java.lang.Integer">
        SELECT count(*) FROM `works`
        <if test="wname !=null ">
            WHERE wname like #{wname}
        </if>
            and tid = #{id}
    </select>

    <select id="getCourseCounts" resultType="java.lang.Integer">
        SELECT count(*) FROM `course` where 1=1
        <if test="cname !=null and cname != ''">
            and cname like CONCAT('%',#{cname},'%')
        </if>
        <if test="cid !=null and cid != ''">
            and cid = #{cid}
        </if>
        <if test="tid !=null and tid != ''">
            and tid like CONCAT('%',#{tid},'%')
        </if>
        <if test="departmentname !=null and departmentname != ''">
            and departmentname  like CONCAT('%',#{departmentname},'%')
        </if>
        <if test="majorname !=null and majorname != ''">
            and majorname like CONCAT('%',#{majorname},'%')
        </if>
    </select>

    <select id="getUpdateWork" resultType="com.tjy.domian.Work">
        SELECT * FROM works WHERE id = #{id}
    </select>

    <select id="getWorkById" resultType="com.tjy.domian.Work">
        SELECT * FROM works WHERE id = #{id}
    </select>

    <select id="getForm" resultType="com.tjy.domian.Form">
        SELECT * FROM form WHERE id = #{id}
    </select>

    <insert id="editForm">
        INSERT INTO form
        (id,wid,situation,attendanceRate,teacherStatus,cid,departmentname,majorname,createtime,evaluate,remarks)
        VALUE
        (#{id},#{wid},#{situation},#{attendanceRate},#{teacherStatus},#{cid},#{departmentname},#{majorname},#{createtime},#{evaluate},#{remarks}) ON DUPLICATE KEY UPDATE wid=values(wid),
            situation=values(situation),
            attendanceRate=values(attendanceRate),
            teacherStatus=values(teacherStatus),
            cid=values(cid),
            departmentname=values(departmentname),
            majorname=values(majorname),
            createtime=values(createtime),
            evaluate=values(evaluate),
            remarks = values(remarks)
    </insert>

    <insert id="addWork">
        INSERT INTO works
            (wname,time,
        <if test="tid !=null ">
            tid,
        </if>
        <if test="ownerName !=null ">
            ownerName,
        </if>
        <if test="isfinished !=null ">
            isfinished,
        </if>
             cid,cname,tname,creatime,address,week)
            VALUE
            (#{wname},#{time},
        <if test="tid !=null ">
            #{tid},
        </if>
        <if test="ownerName !=null ">
            #{ownerName},
        </if>
        <if test="isfinished !=null ">
            #{isfinished},
        </if>
            #{cid},#{cname},#{tname},#{creatime},#{address},#{week})
    </insert>

    <insert id="addCourse">
        INSERT INTO course
            (cname,cid,tid,
        <if test="time1 !=null ">
            time1,
        </if>
        <if test="time2 !=null ">
            time2,
        </if>
        <if test="time3 !=null ">
            time3,
        </if>
        <if test="time4 !=null ">
            time4,
        </if>
        <if test="time5 !=null ">
            time5,
        </if>
        start,end,departmentname,majorname,address)
            VALUES
            (#{cname},#{cid},#{tid},
        <if test="time1 !=null ">
            #{time1},
        </if>
        <if test="time2 !=null ">
            #{time2},
        </if>
        <if test="time3 !=null ">
            #{time3},
        </if>
        <if test="time4 !=null ">
            #{time4},
        </if>
        <if test="time5 !=null ">
            #{time5},
        </if>
            #{start},#{end},#{departmentname},#{majorname},#{address})
    </insert>


    <update id="editWork">
        UPDATE works SET wname = #{wname},tid = #{tid},ownerName = #{ownerName},time = #{time} WHERE id = #{id}
    </update>

    <update id="editWorkStatus">
        UPDATE works SET isfinished = 1,formid = #{id} WHERE id = #{wid}
    </update>

    <update id="updateWorkStatus">
        UPDATE works SET isfinished = 0,tid = #{userId} WHERE id = #{id}
    </update>

    <update id="receiveWork">
        UPDATE works SET ownerName = #{name} WHERE id = #{id}
    </update>

    <update id="updateWorkTeacher">
        UPDATE works SET ownerName = #{ownerName} WHERE id = #{id}
    </update>



    <delete id="deleteWork">
        DELETE FROM works WHERE id = #{id}
    </delete>

</mapper>